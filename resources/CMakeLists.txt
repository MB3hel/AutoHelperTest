cmake_minimum_required (VERSION 2.8.12)

# This is a comma seperated list of resource files (in this directory)
set(INPUT_FILES)

set(OUTPUT_H "resources.h")

if("${INPUT_FILES}" EQUAL "")

    # Create header
    file(WRITE ${OUTPUT_H} "/* Autogenerated by bin2c */\n\n")
    file(APPEND ${OUTPUT_H} "#ifndef __RESOURCES_H__\n")
    file(APPEND ${OUTPUT_H} "#define __RESOURCES_H__\n")

    string(REPLACE "," ";" INPUT_LIST ${INPUT_FILES})


    # Iterate through binary files files
    foreach(bin ${INPUT_LIST})
        # Get short filename
        string(REGEX MATCH "([^/]+)$" filename ${bin})
        # Replace filename spaces & extension separator for C compatibility
        string(REGEX REPLACE "\\.| |-" "_" filename ${filename})
        # Convert to lower case
        string(TOLOWER ${filename} filename)
        # Read hex data from file
        file(READ ${bin} filedata HEX)
        # Convert hex data for C compatibility
        string(REGEX REPLACE "([0-9a-f][0-9a-f])" "0x\\1," filedata ${filedata})
        # Append data to c file
        file(APPEND ${OUTPUT_H} "const unsigned char ${filename}[] = {${filedata}};\nconst long int ${filename}_size = sizeof(${filename});\n\n")
        # Append extern definitions to h file
    endforeach()

    file(APPEND ${OUTPUT_H} "#endif //__RESOURCES_H__\n")

endif()